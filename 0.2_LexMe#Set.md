Tutorial
https://www.youtube.com/watch?v=Q4rXmxQ1AUM&t=269s

Original App-Source:
https://github.com/pixegami/task-app

# SETUPS:
-------------
----------
## Supabase CLI (install):
```
supabase init
supabase link --project-ref $PROJECT_REF
```
Supabase-Linktest:
```
supabase projects list
```
----------
## Google
console.cloud.google -> credentials -> API Services
Add:
-> Webapplication

* Authorised Javascript origins

URI1 ```https://[PROJECT_ID].supabase.co```

URI2 ```https://localhost```

URI3 ```http://localhost```

* Authorised redirect URIs

```https://[PROJECT_ID].supabase.co/auth/v1/callback```
* -> Redirect to Supabase -> Authentication -> Providers -> Google == (Enable Sign In + Client-/Secret-/ID)
----------
## Set Supabase projects:
### (README.md(5))
```
supabase secrets set STRIPE_SECRET_KEY=sk_test_xxx
supabase secrets set STRIPE_PRICE_ID=price_xxx
supabase secrets set STRIPE_WEBHOOK_SECRET=whsec_xxx
```
* Supase-Secret-Test:
```
supabase secrets list
```
### (README.md (5.(Branch == main))) => Deprecated)

(in Supabase - SQL Editor)
Create SQL Snippet (sk_test_xxx = secret_key):
```sql
insert into vault.secrets (name, secret)
    values ('stripe', 'your-stripe-secret-key')
    returning key_id;
```
* Or if you need to update it later, use:*
```sql
update vault.secrets
    set secret = 'your-new-stripe-secret-key'
    where name = 'stripe'
    returning key_id;
```
------
## Apply DB migrations (in Supabase CLI)
```supabase db push```

* Reset and re-run everything
```
supabase db reset --linked
```
------
* For API Operations (automatically created by Supabase as default (Rest API Documention))
```
const { data, error } = await supabase
  .from ("tasks")
  .insert({ title, description })
  .select();
```
-----------
## Stripe (install):
```stripe login```

(Lookup in Readme for commands)
- Create a product
- Create billing portal configuration (replace urls with own supabase.co)
- Ceate Webhook Endpoint  (Stripe Portal)
---------
# Deployment

* Deploy edge functions (Supabase CLI)
```
supabase functions deploy create-task-with-ai
supabase functions deploy create-stripe-session
supabase functions deploy stripe-webhook
```
## Supabase Settings (Stripe Restrictions)
* Disable JWT Enforce Verification in (README.md(4)):
```
(Supabase -> Edge Functions -> stripe-webhook -> Details -> Function Config -> JWT == (Disable))
```
---------
## Supabase Storage Bucket (Build by App auto.)
* Set to Private (Hide Image URLs of Users)
---------
# Terminal:
```
cd supabase

supabase start
```
(starts the local Supabase services, including the Postgres database, with Docker).
```
supabase migration up
```
(Apply the database migrations: This step is critical because it creates the database structure (tables, columns, etc.) that the application needs).

--------
# Starte App (Terminal):
```npm run dev```
---------
# Test App:
```npm test```
--------
# Run specific test file
```npm test tests/integration/2_auth.test.ts```
